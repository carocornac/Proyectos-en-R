---
title: "AnÃ¡lisis de Reglas de AsociaciÃ³n con Apriori"
author: "Carolina Cornacchia"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 2
---

## ğŸ“Œ IntroducciÃ³n

Las reglas de asociaciÃ³n permiten descubrir relaciones interesantes entre productos en transacciones de compra. En este anÃ¡lisis se utiliza el algoritmo Apriori para identificar patrones frecuentes en un conjunto de datos de mercado.

## ğŸ§° MetodologÃ­a

Se utiliza el paquete `arules` de R para transformar los datos en transacciones y aplicar el algoritmo Apriori. Los parÃ¡metros de soporte y confianza se ajustan para obtener reglas significativas.

## ğŸ’¡Pasos para realizar el trabajo

### Paso 1: Elegir el Dataset y cargarlo en R

Para poder comenzar con este trabajo, busquÃ© un dataset en la pÃ¡gina web Kaggle el cuÃ¡l se llama **"Real Market Data for Association Rules"**. Este me permitiÃ³ aplicar las metodologÃ­as necesarias para mi Analisis de AsociaciÃ³n.

#### ğŸ”— Enlace

Link : (<https://www.kaggle.com/datasets/rukenmissonnier/real-market-data>)

Ahora si, descargamos las librerias y creamos una nueva variable *"data_market"* con nuestro dataset:

```{r setup, message=FALSE, warning=FALSE}
#install.packages("arules")
library(arules)
data_market <- read.csv("market.csv", sep = ";", header = TRUE)
```

Veamos un poco el dataset que cargamos:

```{r}
head(data_market)
```

### Paso 2: Convertir el dataset en transaccional

Para poder utilizar la funciÃ³n Apriori si o si debemos contar con un dataset en formato transaccional. En primer lugar, utilizamos la funciÃ³n class para entender cuÃ¡l es el formato de *data_market*:

```{r}
class(data_market)
```

*data_market* estÃ¡ guardado como un `data frame`.
Para poder cambiarlo a un formato transaccional, primero debemos convertir los 1s en nombres de productos con la funciÃ³n *apply*: 

```{r}
transactions_list <- apply(data_market, 1, function(row) {
  names(row)[which(row == 1)]
})
```


Luego, utilizamos la funciÃ³n as para convertirlo en un archivo con formato `transaccional`: 

```{r, warning=FALSE}
#Lo paso en transacciones
trans_market <- as(transactions_list, "transactions")
class(trans_market)
```

Verificamos la conversion con la funciÃ³n *summary* 

```{r}
# Verificar la conversiÃ³n
summary(trans_market)
```

### Paso 3: Aplicamos nuestro algoritmo Apriori

Con los datos listos, podemos empezar a aplicar apriori! Solamente tenemos que elegir los valores de:

#### ğŸ“ ParÃ¡metros del algoritmo Apriori
El algoritmo Apriori utiliza dos parÃ¡metros clave para generar reglas de asociaciÃ³n:

  1) *Soporte (support)*: indica la proporciÃ³n de transacciones en las que aparece un conjunto de productos. Un soporte de 0.13 significa que la regla debe estar presente en al menos el 13% de las transacciones. Este valor permite enfocarse en patrones que ocurren con frecuencia significativa, evitando reglas demasiado raras que podrÃ­an no ser Ãºtiles en la prÃ¡ctica.

  2) *Confianza (confidence)*: mide la probabilidad de que, dado que se comprÃ³ un conjunto de productos, tambiÃ©n se compre el producto asociado. Una confianza de 0.6 implica que la regla debe cumplirse al menos el 60% de las veces. Este umbral garantiza que las asociaciones encontradas sean consistentes y fiables.

Se eligieron estos valores (supp = 0.13, conf = 0.6) para lograr un equilibrio entre frecuencia y fuerza de la asociaciÃ³n. **Un soporte del 13% asegura que las reglas descubiertas no sean anecdÃ³ticas, mientras que una confianza del 60% permite identificar relaciones con un grado razonable de certeza, sin ser demasiado restrictivo.**

```{r}
# Aplicar Apriori
rules <- apriori(trans_market, parameter = list(supp = 0.13, conf = 0.60))
cat("Cantidad de reglas generadas:", length(rules), "\n")
```

```{r}
# Vemos las reglas
inspect(rules[1:10])
```

### Paso 4: Ordenamos los datos por "LIft"

#### ğŸ“Š Ordenamiento por Lift

Para priorizar las reglas de asociaciÃ³n generadas, se utilizÃ³ el criterio de **lift** como mÃ©trica principal de ordenamiento. El **lift** mide cuÃ¡nto mÃ¡s probable es que dos productos se compren juntos en comparaciÃ³n con si fueran independientes. En otras palabras, indica la fuerza de la asociaciÃ³n entre los productos.

Un valor de lift mayor a 1 sugiere que existe una relaciÃ³n positiva entre los productos: se compran juntos con mÃ¡s frecuencia de lo esperado por azar. Cuanto mÃ¡s alto sea el lift, mÃ¡s significativa es la regla.

Ordenar por **lift** permite identificar primero las reglas mÃ¡s *interesantes* y *Ãºtiles*, ya que no solo tienen buen soporte y confianza, sino que tambiÃ©n revelan comportamientos no triviales en los datos. Este enfoque ayuda a descubrir oportunidades de negocio, como promociones cruzadas o recomendaciones de productos.

```{r}
rules_sorted_market <- sort(rules, by = "lift", decreasing = TRUE)
# Inspeccionar las primeras reglas
inspect(rules_sorted_market[1:10])
```

### Paso 5: ğŸ’° AnÃ¡lisis EconÃ³mico Basado en Ingresos Estimados

Para evaluar el impacto econÃ³mico de las reglas de asociaciÃ³n encontradas, se estimaron los ingresos generados por cada combinaciÃ³n de productos. Se asumiÃ³ un valor unitario de $40 por producto, lo que permite calcular el ingreso total multiplicando la cantidad de unidades por este valor.

```{r}
# Definir un valor promedio por transacciÃ³n
valor_promedio_tran <- 40 

# FunciÃ³n para calcular valor econÃ³mico
calcular_valor_ec <- function(rules) {
  total_oc <- interestMeasure(rules, measure = "support", trans) * nrow(data_market) # ocurrencias
  ingresos_estimados2 <- total_oc * valor_promedio_tran # ingreso estimado
  return(ingresos_estimados2)
}

# Aplicar la funciÃ³n para calcular el valor econÃ³mico
ingresos_por_regla2 <- calcular_valor_ec(rules_sorted_market)

# âœ… CORREGIDO:
df_reglas_economicas2 <- as(rules_sorted_market, "data.frame")

# Agregar ingresos estimados
df_reglas_economicas2$Ingresos_Estimados <- ingresos_por_regla2
df_reglas_economicas2
```

#### ğŸ“Š Resultados Observados
Las reglas con mayor **lift** (por ejemplo, {Bacon, Cheese} => {Butter} con lift de 1.64) tambiÃ©n presentan altos niveles de **support** y **confidence**, lo que indica que ocurren con frecuencia y tienen una fuerte relaciÃ³n.

Las combinaciones mÃ¡s frecuentes (como las reglas 1, 3 y 10) generaron ingresos estimados de $2,560 o $2,600, lo que representa un rendimiento econÃ³mico significativo.

Las reglas con menor frecuencia (como la regla 4 con 61 unidades) aÃºn generan ingresos sÃ³lidos de $2,440, lo que sugiere que incluso asociaciones menos frecuentes pueden ser rentables si se mantienen consistentes.

#### ğŸ“ˆ InterpretaciÃ³n

El anÃ¡lisis muestra que las reglas de asociaciÃ³n no solo revelan patrones de compra, sino que tambiÃ©n pueden traducirse en estrategias comerciales efectivas. Por ejemplo:

1. ğŸ›’ Promocionar productos que aparecen juntos en reglas con alto lift puede aumentar las ventas cruzadas.

2. ğŸ§  Identificar combinaciones con alto ingreso estimado permite priorizar el stock y la visibilidad de esos productos en el punto de venta.

3. ğŸ’¡ Las reglas con ingresos superiores a $2,500 pueden considerarse candidatas para campaÃ±as de marketing especÃ­ficas, ya que tienen impacto econÃ³mico directo.

# ğŸš€Â¡Muchas gracias!



