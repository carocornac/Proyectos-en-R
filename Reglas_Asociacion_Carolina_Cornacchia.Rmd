---
title: "Análisis de Reglas de Asociación con Apriori"
author: "Carolina Cornacchia"
date: "`r Sys.Date()`"
output: 
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 2
---

## 📌 Introducción

Las reglas de asociación permiten descubrir relaciones interesantes entre productos en transacciones de compra. En este análisis se utiliza el algoritmo Apriori para identificar patrones frecuentes en un conjunto de datos de mercado.

## 🧰 Metodología

Se utiliza el paquete `arules` de R para transformar los datos en transacciones y aplicar el algoritmo Apriori. Los parámetros de soporte y confianza se ajustan para obtener reglas significativas.

## 💡Pasos para realizar el trabajo

### Paso 1: Elegir el Dataset y cargarlo en R

Para poder comenzar con este trabajo, busqué un dataset en la página web Kaggle el cuál se llama **"Real Market Data for Association Rules"**. Este me permitió aplicar las metodologías necesarias para mi Analisis de Asociación.

#### 🔗 Enlace

Link : (<https://www.kaggle.com/datasets/rukenmissonnier/real-market-data>)

Ahora si, descargamos las librerias y creamos una nueva variable *"data_market"* con nuestro dataset:

```{r setup, message=FALSE, warning=FALSE}
#install.packages("arules")
library(arules)
data_market <- read.csv("market.csv", sep = ";", header = TRUE)
```

Veamos un poco el dataset que cargamos:

```{r}
head(data_market)
```

### Paso 2: Convertir el dataset en transaccional

Para poder utilizar la función Apriori si o si debemos contar con un dataset en formato transaccional. En primer lugar, utilizamos la función class para entender cuál es el formato de *data_market*:

```{r}
class(data_market)
```

*data_market* está guardado como un `data frame`.
Para poder cambiarlo a un formato transaccional, primero debemos convertir los 1s en nombres de productos con la función *apply*: 

```{r}
transactions_list <- apply(data_market, 1, function(row) {
  names(row)[which(row == 1)]
})
```


Luego, utilizamos la función as para convertirlo en un archivo con formato `transaccional`: 

```{r, warning=FALSE}
#Lo paso en transacciones
trans_market <- as(transactions_list, "transactions")
class(trans_market)
```

Verificamos la conversion con la función *summary* 

```{r}
# Verificar la conversión
summary(trans_market)
```

### Paso 3: Aplicamos nuestro algoritmo Apriori

Con los datos listos, podemos empezar a aplicar apriori! Solamente tenemos que elegir los valores de:

#### 📐 Parámetros del algoritmo Apriori
El algoritmo Apriori utiliza dos parámetros clave para generar reglas de asociación:

  1) *Soporte (support)*: indica la proporción de transacciones en las que aparece un conjunto de productos. Un soporte de 0.13 significa que la regla debe estar presente en al menos el 13% de las transacciones. Este valor permite enfocarse en patrones que ocurren con frecuencia significativa, evitando reglas demasiado raras que podrían no ser útiles en la práctica.

  2) *Confianza (confidence)*: mide la probabilidad de que, dado que se compró un conjunto de productos, también se compre el producto asociado. Una confianza de 0.6 implica que la regla debe cumplirse al menos el 60% de las veces. Este umbral garantiza que las asociaciones encontradas sean consistentes y fiables.

Se eligieron estos valores (supp = 0.13, conf = 0.6) para lograr un equilibrio entre frecuencia y fuerza de la asociación. **Un soporte del 13% asegura que las reglas descubiertas no sean anecdóticas, mientras que una confianza del 60% permite identificar relaciones con un grado razonable de certeza, sin ser demasiado restrictivo.**

```{r}
# Aplicar Apriori
rules <- apriori(trans_market, parameter = list(supp = 0.13, conf = 0.60))
cat("Cantidad de reglas generadas:", length(rules), "\n")
```

```{r}
# Vemos las reglas
inspect(rules[1:10])
```

### Paso 4: Ordenamos los datos por "LIft"

#### 📊 Ordenamiento por Lift

Para priorizar las reglas de asociación generadas, se utilizó el criterio de **lift** como métrica principal de ordenamiento. El **lift** mide cuánto más probable es que dos productos se compren juntos en comparación con si fueran independientes. En otras palabras, indica la fuerza de la asociación entre los productos.

Un valor de lift mayor a 1 sugiere que existe una relación positiva entre los productos: se compran juntos con más frecuencia de lo esperado por azar. Cuanto más alto sea el lift, más significativa es la regla.

Ordenar por **lift** permite identificar primero las reglas más *interesantes* y *útiles*, ya que no solo tienen buen soporte y confianza, sino que también revelan comportamientos no triviales en los datos. Este enfoque ayuda a descubrir oportunidades de negocio, como promociones cruzadas o recomendaciones de productos.

```{r}
rules_sorted_market <- sort(rules, by = "lift", decreasing = TRUE)
# Inspeccionar las primeras reglas
inspect(rules_sorted_market[1:10])
```

### Paso 5: 💰 Análisis Económico Basado en Ingresos Estimados

Para evaluar el impacto económico de las reglas de asociación encontradas, se estimaron los ingresos generados por cada combinación de productos. Se asumió un valor unitario de $40 por producto, lo que permite calcular el ingreso total multiplicando la cantidad de unidades por este valor.

```{r}
# Definir un valor promedio por transacción
valor_promedio_tran <- 40 

# Función para calcular valor económico
calcular_valor_ec <- function(rules) {
  total_oc <- interestMeasure(rules, measure = "support", trans) * nrow(data_market) # ocurrencias
  ingresos_estimados2 <- total_oc * valor_promedio_tran # ingreso estimado
  return(ingresos_estimados2)
}

# Aplicar la función para calcular el valor económico
ingresos_por_regla2 <- calcular_valor_ec(rules_sorted_market)

# ✅ CORREGIDO:
df_reglas_economicas2 <- as(rules_sorted_market, "data.frame")

# Agregar ingresos estimados
df_reglas_economicas2$Ingresos_Estimados <- ingresos_por_regla2
df_reglas_economicas2
```

#### 📊 Resultados Observados
Las reglas con mayor **lift** (por ejemplo, {Bacon, Cheese} => {Butter} con lift de 1.64) también presentan altos niveles de **support** y **confidence**, lo que indica que ocurren con frecuencia y tienen una fuerte relación.

Las combinaciones más frecuentes (como las reglas 1, 3 y 10) generaron ingresos estimados de $2,560 o $2,600, lo que representa un rendimiento económico significativo.

Las reglas con menor frecuencia (como la regla 4 con 61 unidades) aún generan ingresos sólidos de $2,440, lo que sugiere que incluso asociaciones menos frecuentes pueden ser rentables si se mantienen consistentes.

#### 📈 Interpretación

El análisis muestra que las reglas de asociación no solo revelan patrones de compra, sino que también pueden traducirse en estrategias comerciales efectivas. Por ejemplo:

1. 🛒 Promocionar productos que aparecen juntos en reglas con alto lift puede aumentar las ventas cruzadas.

2. 🧠 Identificar combinaciones con alto ingreso estimado permite priorizar el stock y la visibilidad de esos productos en el punto de venta.

3. 💡 Las reglas con ingresos superiores a $2,500 pueden considerarse candidatas para campañas de marketing específicas, ya que tienen impacto económico directo.

# 🚀¡Muchas gracias!



